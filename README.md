# 合同信息抽取

## 场景介绍
合同信息抽取旨在从大量真实法律合同中提炼出有关整篇合同的一些关键信息，从而提高签约当事人或法企、法院等审核合同的效率。本服务提供的是基于 UIE 在履约任务标注数据上进行 few-shot 的实体抽取模型，目前可抽取合同的基础信息有 “合同编号”，“开始时间”，“结束时间”，“签约双方” ，“合同状态” 。

## Docker调试

1.  拉取镜像
    ```
    docker pull harbor.deepwisdomai.com/deepwisdom/contract_info_extraction:v1.0.0
    ```

2. 启动容器
   
    注："/data/wuxiang/checkpoint" 为 2080A 机器上预训练模型的路径

    ```
    docker run -it -v /data/wuxiang/checkpoint:/wow/contract_info/checkpoint --name contract_info_extra -p 8282:8080 harbor.deepwisdomai.com/deepwisdom/contract_info_extraction:v1.0.0
    ```

## 本地调试
   
以在 2080A 机器上调试为例：

1. 修改 service.py 里模型的加载路径

   ```
   task_path='/data/wuxiang/checkpoint/model_best2'
   ```

2. 修改 service.py 里的 host 和 port
   
   ```
   host = '192.168.50.121' # 2080A 的 host
   port = 8282
   ```

## 启动服务
```
python service.py
```

## 输入示例
1. 单篇合同的OCR结果
    ```
    input_data = ['      合同编号：ZL-2022060201 \n', '物 \n', '业  \n', '租  \n', '赁  \n', '合  \n', '同  \n', '书   \n', '第 1 页 共 5 页 \n', '物 业 租 赁 合 同 书   \n', '出租方：   嘉笛瑞普（苏州）商业管理有限公司     (以下简称甲方） \n', '地 址：苏州工业园区和顺路 29 号          \n', '法定代表： 刘俊   \n', '电 话：    13661907055         \n', '承租方：   中栎苏州建设工程有限公司江苏分公司   (以下简称乙方） \n', '地 址：苏州工业园区唯新路 7 号 C1-1 一楼门厅+2 楼 \n', '法定代表：  \n', '电 话： \n', '  根据有关法律法规，甲乙双方经友好协商一致达成如下条款，以供遵守。 \n', '第一条 租赁物位置、面积、功能及用途 \n', '1.1 甲方将位于  工业园区唯新路 7 号 C1-1 一楼门厅+2 楼  的  201 室  物业，\n', '租赁面积约为 400 平方米（以下简称租赁物）租赁于乙方使用。 \n', '1.2 本租赁物采取租赁的方式，由乙方自行管理。在租赁期间，乙方按照上述用\n', '途使用物业，乙方对建筑结构、公共部位外观及建筑外立面不得予以破环。乙方\n', '在使用物业期间，应严格遵守本合同（包含各合同附件）及中国法律、法规的规\n', '定。 \n', '第二条 租赁期限   \n', '2.1 租赁期限为   2   年，即从   2022   年  06  月 03 日起至  2024 年  \n', '06 月 02 日，前期装修期为  10 天，装修期内甲方免收租金。 \n', '2.2 租赁期限届满前  3  个月提出，经甲方同意后，甲乙双方将对有关租赁事\n', '项重新签订租赁合同。在同等承租条件下，乙方有优先权。 \n', '第三条 租赁费用 \n', '3.1 租金：物业租金     2022-06-03    至     2024-06-02     ，即租金为 \n', '8000.00 元/月，以上租金为含税租赁税费。 \n', '第 2 页 共 5 页 \n', '第四条 租赁费用的支付 \n', '4.1 乙方应于应付房租到期日前 10 日向甲方 支付租金，若乙方推迟付款则甲方\n', '有权加收每日百分之一的滞纳金费用；此房采用先付后租的方式，付款额为付  \n', '陆个月房租，押金 贰个月房租。 \n', '4.2 租赁期间，如因乙方因违反本租赁合同约定给甲方造成财产损失的或有其他\n', '违约行为 的，甲方有权从该保证金中直接扣划乙方应承担的违约金或甲方由此遭\n', '受实际损失，甲方扣划后将及时通知乙方。乙方须于收到上述通知后 7 日内，\n', '向甲方补足被扣划的保证金，除非此时租赁合同已终止。乙方对甲方扣划行为有\n', '异议的，可通过磋商或诉讼、仲裁等方式主张权利，但不影响先行补足保证金的\n', '义务。 \n', '4.3 租赁期满，乙方结清房租及其他费用，甲方应将保证金无息退还乙方。 \n', '第五条 专用设施、场地的维修、保养 \n', '5.1 乙方在租赁期间应负责租赁物内各项设施的维 护、保养，符合各项安全要求，\n', '甲方对此有检查监督权，乙方有义务按照甲方要求进行整改及完善。乙方对租赁\n', '物的使用期间，甲方应保证租赁物的正常使用功能。  \n', '5.2 乙方对租赁物附属物负有妥善使用及维护之责任，对各种可能出现的故障 和\n', '危险应及时消除，以避免一切可能发生的隐患。  \n', '5.3 乙方在租赁期限内应爱护租赁物，因乙方使用不当造成租赁物损坏，乙方应\n', '负责维修，费用由乙方承担。 \n', '第六条 安全与责任 \n', '6.1 乙方在租赁期间须严格遵守国家各项法律法规以及甲方有关制度，积极配合\n', '甲方做好安全防范工作。由乙方原因产生的一切责任及损失由乙方承担。 \n', '6.2 乙方应按有关规定全面负责租赁物内的各项安全工作，甲方有权于合理时间\n', '内检查租赁物的安全，但应尽量事先通知乙方，乙方不得无理拒绝或延迟给予同\n', '意。 \n', '6.3 乙方在租赁期间应遵法经营。如违法，所造成的一切后果均由乙方承担。无\n', '论是否终止本合同，乙方因租用期间产生的一切纠纷概由乙方负责处理。 \n', '6.4 乙方不得将物业转租给第三方，否则，甲方有权无偿 收回租赁物。 \n', '第 3 页 共 5 页 \n', '第七条  管 理 \n', '7.1 乙方在租赁期满或合同提前终止时，应于租赁期满之日或提前终止之日将租\n', '赁物清扫干净，搬迁完毕，并将租赁物交还给甲方。 \n', '7.2 乙方在使用租赁物时必须遵守中华人民共和 国的法律、苏州市法规以及甲方\n', '管理的有关规定，如有违反，应承担相应责任。由于乙方原因所造成损失由乙方\n', '赔偿。 \n', '7.3 乙方人员应做好租赁区域环境卫生和个人卫生，维护园区形象。 \n', '7.4 租赁区域不可做机加工厂房使用。 \n', '第八条 装修条款 \n', '8.1 在租赁期限内如乙方须对租赁物进行装修、改建，须事先向甲方提交装修、\n', '改建设计方案，并经甲方同意后，方可进行施工。 \n', '8.2 如装修、改建方案可能对公用部分及其它相邻用户影响的，甲方可对该部分\n', '方案提出异议，乙方应予以修改。改建、装修费用由乙方承担。 \n', '8.3 如乙方的装修、改建方案可能对租赁物主结构造成影响的，则应经甲方同意\n', '后方能进行。 \n', '第九条 提前终止合同 \n', '9.1 如合同未到期，需提前解约，解约方须提前  2  个月书面通知对方，经双\n', '方同意后，方可提前解约。否则视为违约，违约方须向另一方支付  贰  个月租\n', '金作为赔偿。 \n', '9.2 合同期满，在同等价位上乙方有优先租赁权。 \n', '第十条 免责条款 \n', '10.1 若因政府有关租赁行为的法律法规的修改或其他导致甲方无法继续履行本\n', '合同时，甲方可因此而免责。 \n', '10.2 凡因发生严重自然灾害、战争或其他不能预见的、其发生和后果不能防止\n', '或避免的不可抗力致使任何一方不能履行本合同时，遇有上述不可抗力的一方，\n', '应立即用邮递或传真通知 对方，并应在三十日内，提供不可抗力的详情及合同不\n', '能履行，或不能部分履行，或需延期履行理由的证明文件。如无法提供证明文件\n', '的，则提供其他有力证明。遭受不可抗力的一方由此而免责。 \n', '第 4 页 共 5 页 \n', '第十一条 合同的终止 \n', '  本合同提前终止或有效期届满，甲、乙双方未达成续租协议的，乙方应于终\n', '止之日或租赁期限届满之日迁离租赁物，并将其返还甲方。未经甲方同意，乙方\n', '逾期不迁离或不返还租赁物的，应向甲方支付三倍租金。甲方有权强行将租赁物\n', ' 内的物品搬离租赁物，并自行处理租赁场地内物品。 \n', '第十二条 广告 \n', '未经甲方许可，乙方不得在私自租赁物建筑物的周围或公共可见部位设立广\n', '告牌或标识，广告牌或标识由甲方统一制作、安装，收取相应制作、安装费。 \n', '第十三条（附 加条款） \n', '13.1 甲方必须保证乙方的用电用水，电费为  1.5  元/度；水费为  5  元/吨。 \n', '13.2 因非甲方主观意愿的停电、水对乙方造成的影响和损失甲方不承担责任。 \n', '13.3 若因政府等不可抗力原因需要拆迁，政府的土地及房屋赔偿费用归 甲方；\n', '甲方需政府发放的搬迁补偿费用归乙方；在租赁期间由乙方施工的装修补偿费用\n', '归乙方。  \n', '第十四条 适用法律 \n', '本合同在履行中发生争议，应由双方协商解决，若协商不成， 则通过仲裁\n', '程序解决。 \n', '第十五条 其它条款 \n', '15.1 本合同未尽事宜，经双方协商一致后，可另行签订补充协议。 \n', '15.2 本合同一式贰份，甲、乙双方各执壹份。 \n', '第十六条 合同效力 \n', '本合同经双方签字盖章后生效。 \n', '甲方（签字）：                      乙方（签字）： \n（印章）： \n                 （印章）： \n', '                                  签订时间：      年   月    日 \n', '第 5 页 共 5 页 \n']
    ```

2. 单篇合同（PDF）的路径
    ```
    file_path = "./杭州日晟-原始稿-杨晓青.pdf"
    ```

## 请求示例
1. 单篇合同的文本输入（如：OCR结果）
    ```
    import requests
    import json

    if __name__ == "__main__":

        url = 'http://192.168.50.121:8282/contract_info_extraction'  # 服务地址（ocr后的结果）
        input_data = [
                '''
                合同编号：FXTZ/XY2020XXXX
                ''',
                '''
                深圳大学附属教育集团外国语小学食材配送服务合同
                甲方： 深圳大学附属教育集团外国语小学
                乙方： 深圳市仲康时代餐饮有限公司
                根据深圳市政府采购中心 0832-SFCX21FSC164 号招标项目的投标结果，由深
                圳市仲康时代餐饮有限公司为中标方。按照《中华人民共和国民法典》和《深圳经
                济特区政府采购条例》，经深圳大学附属教育集团外国语小学（以下简称甲方）和
                ''',
                '''
                深圳市仲康时代餐饮有限公司（以下简称乙方）协商，就甲方委托乙方承担 深圳
                大学附属教育集团外国语小学食材配送服务项目，达成以下合同条款：
                第一条 项目概况
                ''',
                '''
                项目名称：深圳大学附属教育集团外国语小学食材配送服务项目
                项目内容： 深圳大学附属教育集团外国语小学食堂主食、副食配送服务
                服务时间：2021 年 8 月 17 日-2022 年 8 月 16 日，本项目为长期服务类项目，
                第一年为本次招标的中标服务期限，采购人可根据项目需求和中标供应商的履约情
                况确定合同期限是否延长，但最长不超过三年。
                ''',
                '''
                合同价款：合同总价为 450000*0.97=436500 元，含一切税费。本合同总价包
                括乙方为实施本项目所需的服务和技术费用等，为固定不变价格，且不随通货膨胀
                的影响而波动。合同总价包括乙方履行本合同义务所发生的一切税费、费用和支出。
                如发生本合同规定的不可抗力，合同总价可经双方友好协商予以调整。'''
        ]
        resp = requests.request("POST", url, data=json.dumps(input_data)) 
        print(json.dumps(resp.json(), ensure_ascii=False, indent=4))
    ```

2. 单篇合同（PDF）
    ```
    import requests
    import json

    if __name__ == "__main__":

        url = 'http://192.168.50.121:8282/contract_info_extraction_pdf'  # 服务地址（pdf合同）
        file_path = './杭州日晟-原始稿-杨晓青.pdf' 
        resp = requests.request("POST", url, data=json.dumps(file_path)) 
        print(json.dumps(resp.json(), ensure_ascii=False, indent=4))
    ```

## 返回示例
1. 单篇合同的OCR
    ```
    {
        "合同编号": "FXTZXY2020XXXX",
        "开始时间": "2021-08-17",
        "结束时间": "2022-08-16",
        "签约双方": [
            "深圳大学附属教育集团外国语小学",
            "深圳市仲康时代餐饮有限公司"
        ],
        "合同状态": "履约结束"
    }
    ```

2. 单篇合同（PDF）
    ```
    {
        "合同编号": "PM20220519003",
        "开始时间": "2022-05-20",
        "结束时间": "",
        "签约双方": [
            "杭州日晟科技有限公司",
            "浙江中苗网络科技有限公司"
        ],
        "合同状态": ""
    }
    ```